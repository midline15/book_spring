<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/user_layout}">
<meta charset="UTF-8">
<th:block layout:fragment="css">
    <style>
        .mgb-15 {
            margin-bottom: 15px;
        }

        .mgt-30 {
            margin-top: 30px;
        }

        .mgt-50 {
            margin-top: 50px;
        }

        .repImgDiv {
            margin-right: 15px;
            height: auto;
            width: 50%;
        }

        .repImg {
            width: 10%;
        }

        .wd50 {
            height: auto;
            width: 50%;
        }

    </style>
</th:block>

<div layout:fragment="content" style="margin-left:25%;margin-right:25%">

    <input type="hidden" id="ebook-id" th:value="${ebook.id}">

    <div class="d-flex">
        <div class="repImgDiv">
            <img th:src="${ebook.url}" class="rounded repImg" th:alt="${ebook.title}">
        </div>
        <div class="wd50">
            <div class="h4" th:text="${ebook.title}"></div>
            <hr class="my-4">

            <div class="text-right">
                <div class="input-group w-50">
                    <div class="input-group-prepend">
                        <span class="input-group-text" th:text="${ebook.intro}"></span>
                    </div>
                </div>
                <hr class="my-4">

                <div class="text-right mgt-50">
                    <h5>결제 금액</h5>
                    <h3 name="totalPrice" id="totalPrice" class="font-weight-bold"></h3>
                </div>
                <div class="text-right">
                    <form th:action="@{/like/ebook/{ebook-id}(ebook-id = ${ebook.id})}" method="post">
                        <button type="submit" class="btn btn-light border border-primary btn-lg">좋아요</button>
                    </form>
                    <button type="button" class="btn btn-primary btn-lg">이용권</button>
                </div>
            </div>
        </div>
    </div>


    <a th:href="@{/writer/ebook/{ebook-id}/episode(ebook-id = ${ebook.id})}">에피소드 등록</a>
    <div data-t-obj="{&quot;click&quot;:{&quot;layer1&quot;:&quot;전체회차목록&quot;}}" class="min-h-360pxr">
        <div> 예 시 용</div>
        <ul class="jsx-2531468679 jsx-376872051 flex"
            style="flex-direction: column; background-color: var(--bg-a-20);"
            th:each="episode : ${ebook.episodeList}">
            <li class="jsx-2531468679 jsx-376872051 list-child-item">
                <div>
                    <div class="relative flex py-8pxr bg-bg-a-20 px-15pxr">
                        <div class="flex items-center">
                            <div class="relative overflow-hidden mr-12pxr shrink-0 w-66pxr"
                                 style="border-radius: 8px;">
                                <div class="jsx-905614930 image-container relative h-full w-full">
                                    <div class="jsx-905614930 absolute top-0 left-0 h-full w-full select-none items-center justify-center bg-s-gray-20/15 object-cover hidden"></div>
                                </div>
                                <div class="absolute top-0 left-0 h-full w-full border-[0.5px] border-solid border-sp-thumb-line"
                                     style="border-radius: 8px;"></div>
                            </div>
                            <div class="flex flex-col">
                                <div class="mb-4pxr flex items-center"><span
                                        class="font-medium2 break-all text-el-60 line-clamp-2"
                                        th:text="${episode.title}"></span>
                                </div>
                                <div class="text-ellipsis line-clamp-1 font-small2 text-el-60"><span
                                        class="break-all align-middle"
                                        th:text="${episode.regTime}">2022.01.12</span>
                                </div>
                                <a th:href="@{/ebook/{ebook-id}/episode/{episode-id} (ebook-id = ${ebook.id}, episode-id=${episode.id})}"
                                   th:if="${episode.buy}">보기</a>
                                <button th:unless="${episode.buy}" th:data-id="${episode.id}" onclick="buyEpisode(this)">구매</button>
                            </div>
                        </div>
                    </div>
                </div>
            </li>

        </ul>
    </div>
    <script>
        function buyEpisode(obj) {
            alert("클릭")
            let ebookId = document.getElementById('ebook-id').value;
            let episodeId = obj.dataset.id;
            fetch(`/ebook/${ebookId}/episode/${episodeId}`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
            })
                .then(() => {
                    alert('구매 완료');
                    fetch(`/inven/ebook/${ebookId}`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                    })
                        .then(() => {
                            alert('보관함 추가 완료');
                            location.replace(`/ebook/${ebookId}/episode/${episodeId}`);
                        });
                });
        }
    </script>
</div>
</html>